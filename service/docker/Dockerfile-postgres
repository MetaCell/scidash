FROM postgres:9.4

ARG ROOT=/
ARG APP_DIR=/app
ARG SCIDASH_BRANCH=$SCIDASH_BRANCH
ARG originBranch=development
ARG defaultBranch=development

WORKDIR $ROOT

# Install git
RUN apt-get update && \
    apt-get install -y git && \
    apt-get clean;

RUN mkdir $APP_DIR

WORKDIR $APP_DIR
RUN git clone -b ${SCIDASH_BRANCH} https://github.com/MetaCell/scidash
COPY ./copy.sh $APP_DIR/
RUN chmod 777 /tmp
RUN ./copy.sh https://github.com/MetaCell/scidash "${SCIDASH_BRANCH}" "${originBranch}" "${defaultBranch}"
RUN cp scidash/service/database/backup_database.sh /backup_database.sh
RUN chmod 0644 /backup_database.sh
RUN cp scidash/service/scripts/db-create-psql.sh /docker-entrypoint-initdb.d/db-create-psql.sh
