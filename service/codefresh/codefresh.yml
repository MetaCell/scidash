version: '1.0'
steps:
  CloningRepo:
    type: git-clone
    title: Cloning Scidash
    repo: MetaCell/scidash.git
    git: CF-default
  InstallFrontend:
    working_directory: ${{CloningRepo}}
    commands:
      - make install-frontend
  BuildingDockerImage:
    title: Building Docker Image
    type: build
    image_name: metacell/scidash
    working_directory: ./
    tag: ${{CF_BRANCH}}-${{CF_BUILD_ID}}
    no_cache: true
    dockerfile: ./service/docker/Dockerfile-scidash
  PushingToDockerRegistry:
    title: Pushing to Docker Registry
    type: push
    candidate: '${{BuildingDockerImage}}'
    tag: ${{CF_BRANCH}}-${{CF_BUILD_ID}}
    registry: cfcr
  RunningDeployScript:
    title: Running Deploy Script
    type: deploy
    kind: kubernetes
    cluster: geppetto-cluster@metacellllc
    namespace: scidash-testing
    service: scidash
    candidate:
      image: ${{BuildingDockerImage}}
      registry: cfcr

